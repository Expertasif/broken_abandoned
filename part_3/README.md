##Broken, Abandoned, and Forgotten Code, Part 2

This code corresponds with [part 3](http://shadow-file.blogspot.com) of the Broken, Abandoned, and Forgotten Code series. In part 3, I walk the reader through how the body of the SOAP request is formed, and parsed by the UPnP daemon.

This update to `setfirmware.py` generates a complete SOAP request including a base64 encoded firmware blob. If a firmware file is specified on the command line, that file is encoded into the request. Otherwise a string of As is base64 encoded and included in the request.

The complete SOAP request generated by `setfirmware.py` looks like:


    POST /soap/server_sa/SetFirmware HTTP/1.1
    Accept-Encoding: identity
    Content-Length: 102401
    Soapaction: "urn:DeviceConfig"
    Host: 127.0.0.1
    User-Agent: Python-urllib/2.7
    Connection: close
    Content-Type: text/xml ;charset="utf-8"

    <SOAP-ENV:Body>
        <NewFirmware>
            <!-- Base64-encoded firmware image goes here. -->
        </NewFirmware>
    </Body>
